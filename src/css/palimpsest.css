/* THE LIGHTHOUSE KEEPER - Palimpsest Aesthetic
   A manuscript that has survived fire, water, time, and lies.
   The only light comes from flame. Everything else is void.
*/

/* ===== THE PALETTE: Fire and Void ===== */
:root {
  /* The Void - TRUE BLACK */
  --void: #000000;
  --deep-char: #0a0604;
  --burnt-umber: #1a0f05;
  --dried-blood: #2a1510;

  /* The Page - Parchment */
  --aged-paper: #c4a882;
  --warm-parchment: #e8d4b8;

  /* The Fire - Illumination */
  --lamp-amber: #d4a030;
  --flame-core: #f0c860;
  --hot-white: #fff4e0;

  /* The Ink - Text */
  --faded-ink: #3a3028;
  --fresh-ink: #1a1410;

  /* The Wound - Violence */
  --old-blood: #4a2020;

  /* Semantic mappings for existing code */
  --sea-deep: var(--void);
  --sea-mid: var(--deep-char);
  --sea-surface: var(--burnt-umber);
  --sea-foam: var(--dried-blood);

  --land-dark: var(--fresh-ink);
  --land-wood: var(--faded-ink);
  --land-sand: var(--aged-paper);
  --land-light: var(--warm-parchment);

  --light-glow: var(--flame-core);
  --light-dim: var(--lamp-amber);
  --light-danger: var(--old-blood);
  --light-warning: var(--lamp-amber);
  --light-verdant: #6a5a30; /* Muted olive - no greens */

  /* Fire animation */
  --flicker-speed: 100ms;
}

/* ===== THE VOID: True Black Foundation ===== */

html, body {
  background: var(--void);
  color: var(--aged-paper);
}

/* The game exists on a desk examining a manuscript */
#game-wrapper {
  position: fixed;
  inset: 0;
  background: var(--void);
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

/* The desk surface - deep wood grain in darkness */
.desk-surface {
  position: absolute;
  inset: 0;
  background:
    linear-gradient(180deg,
      var(--void) 0%,
      var(--deep-char) 50%,
      var(--burnt-umber) 100%
    );
  opacity: 0.3;
}

/* ===== THE MANUSCRIPT FRAME ===== */

.manuscript-frame {
  position: relative;
  width: min(95vw, 1400px);
  height: min(90vh, 900px);
  background: var(--aged-paper);
  box-shadow:
    0 0 60px rgba(0,0,0,0.8),
    0 0 120px rgba(0,0,0,0.6),
    inset 0 0 100px rgba(0,0,0,0.1);
  border-radius: 2px;
}

/* Binding on the left edge */
.manuscript-frame::before {
  content: '';
  position: absolute;
  left: 0;
  top: 5%;
  bottom: 5%;
  width: 20px;
  background:
    linear-gradient(90deg,
      var(--burnt-umber) 0%,
      var(--dried-blood) 30%,
      var(--faded-ink) 50%,
      var(--dried-blood) 70%,
      transparent 100%
    );
  border-radius: 0 2px 2px 0;
}

/* Torn/burned edges */
.manuscript-frame::after {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  border: 1px solid var(--faded-ink);
  border-radius: 2px;
  /* Edge damage simulation */
  mask-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Crect fill='white' x='1' y='1' width='98' height='98' rx='1'/%3E%3C/svg%3E");
}

/* Page damage overlays */
.page-damage {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 5;
}

/* Water stains */
.water-stain {
  position: absolute;
  border-radius: 50%;
  background: radial-gradient(
    ellipse at center,
    rgba(139, 119, 101, 0.15) 0%,
    rgba(139, 119, 101, 0.08) 40%,
    transparent 70%
  );
}

.water-stain-1 {
  top: -5%;
  right: 10%;
  width: 200px;
  height: 150px;
}

.water-stain-2 {
  bottom: 5%;
  left: 5%;
  width: 120px;
  height: 180px;
}

/* Burn marks */
.burn-mark {
  position: absolute;
  background: radial-gradient(
    ellipse at center,
    var(--burnt-umber) 0%,
    rgba(26, 15, 5, 0.5) 30%,
    transparent 60%
  );
}

.burn-mark-1 {
  top: -2%;
  right: -1%;
  width: 80px;
  height: 100px;
  border-radius: 0 0 0 100%;
}

/* Foxing (age spots) */
.foxing {
  position: absolute;
  inset: 0;
  background-image: radial-gradient(
    circle at 20% 30%,
    rgba(139, 119, 101, 0.1) 0%,
    transparent 2%
  ),
  radial-gradient(
    circle at 80% 70%,
    rgba(139, 119, 101, 0.08) 0%,
    transparent 1.5%
  ),
  radial-gradient(
    circle at 50% 10%,
    rgba(139, 119, 101, 0.06) 0%,
    transparent 1%
  ),
  radial-gradient(
    circle at 70% 40%,
    rgba(139, 119, 101, 0.07) 0%,
    transparent 1.2%
  );
}

/* ===== PAPER TEXTURE OVERLAY ===== */

.paper-texture {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 10;
  opacity: 0.12;
  mix-blend-mode: multiply;
  /* Generated paper grain texture */
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
}

/* ===== FIRE FLICKER SYSTEM ===== */

/* The lighthouse lamp - always flickering */
.lighthouse-lamp,
.lamp-light,
[data-light-source="lamp"] {
  animation: fire-flicker 0.15s infinite;
}

@keyframes fire-flicker {
  0%, 100% {
    opacity: 1;
    filter: brightness(1);
  }
  25% {
    opacity: 0.97;
    filter: brightness(0.98);
  }
  50% {
    opacity: 0.99;
    filter: brightness(1.02);
  }
  75% {
    opacity: 0.96;
    filter: brightness(0.97);
  }
}

/* Occasional larger flicker */
@keyframes fire-flicker-large {
  0%, 90%, 100% {
    opacity: 1;
    filter: brightness(1);
  }
  95% {
    opacity: 0.85;
    filter: brightness(0.9);
  }
}

/* Candle flicker - smaller, more frequent */
.candle-light,
[data-light-source="candle"] {
  animation: candle-flicker 0.1s infinite;
}

@keyframes candle-flicker {
  0%, 100% { opacity: 1; }
  33% { opacity: 0.92; }
  66% { opacity: 0.98; }
}

/* ===== ILLUMINATION SYSTEM ===== */

/* Default state: in void/darkness */
.in-darkness {
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s ease;
}

/* Illuminated by beam */
.illuminated {
  opacity: 1;
  visibility: visible;
}

/* Partially illuminated (edge of beam) */
.partial-light {
  opacity: 0.6;
  filter: brightness(0.7);
}

/* The light falloff gradient */
.light-falloff {
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: radial-gradient(
    ellipse at var(--beam-x, 50%) var(--beam-y, 50%),
    transparent 0%,
    transparent 20%,
    rgba(0,0,0,0.3) 40%,
    rgba(0,0,0,0.7) 60%,
    var(--void) 80%
  );
  z-index: 100;
}

/* ===== PALIMPSEST EFFECT ===== */

/* Previous versions bleeding through */
.palimpsest-layer {
  position: absolute;
  inset: 0;
  opacity: 0.08;
  filter: blur(1px) sepia(100%);
  mix-blend-mode: multiply;
  pointer-events: none;
  animation: palimpsest-drift 30s ease-in-out infinite;
}

@keyframes palimpsest-drift {
  0%, 100% { transform: translate(0, 0); }
  25% { transform: translate(1px, 0.5px); }
  50% { transform: translate(2px, 1px); }
  75% { transform: translate(1px, 0.5px); }
}

/* Strikethrough for revisions - original visible beneath */
.revision-strikethrough {
  position: relative;
  color: var(--faded-ink);
  opacity: 0.6;
}

.revision-strikethrough::after {
  content: '';
  position: absolute;
  left: 0;
  right: 0;
  top: 50%;
  height: 1px;
  background: var(--fresh-ink);
  transform: rotate(-0.5deg);
}

/* ===== INK EFFECTS ===== */

/* Fresh ink appearance */
@keyframes ink-bleed {
  0% {
    filter: blur(2px);
    opacity: 0.7;
  }
  50% {
    filter: blur(0.5px);
    opacity: 0.9;
  }
  100% {
    filter: blur(0);
    opacity: 1;
  }
}

.text-placed,
.ink-fresh {
  animation: ink-bleed 0.4s ease-out;
}

/* Ink blot decoration */
.ink-blot {
  position: absolute;
  width: 8px;
  height: 8px;
  background: var(--fresh-ink);
  border-radius: 50% 40% 60% 50%;
  opacity: 0.3;
  transform: rotate(var(--blot-rotation, 0deg));
}

/* ===== CHIAROSCURO PORTRAITS ===== */

.portrait-chiaroscuro {
  position: relative;
  overflow: hidden;
}

/* Half-lit face effect */
.portrait-chiaroscuro::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    90deg,
    transparent 0%,
    transparent 45%,
    rgba(0,0,0,0.4) 55%,
    var(--void) 100%
  );
  pointer-events: none;
  z-index: 1;
}

/* Eyes catch the light */
.portrait-eyes {
  color: var(--flame-core);
  text-shadow: 0 0 10px var(--lamp-amber);
}

/* ===== SILHOUETTE RENDERING ===== */

.silhouette {
  filter: brightness(0) saturate(0);
  opacity: 0.8;
}

.silhouette-revealed {
  filter: none;
  opacity: 1;
  transition: filter 0.5s ease, opacity 0.5s ease;
}

/* ===== MARGIN NOTES (MARGINALIA) ===== */

.marginalia {
  position: absolute;
  font-family: var(--font-display);
  font-style: italic;
  font-size: 0.75rem;
  color: var(--faded-ink);
  opacity: 0.5;
  writing-mode: vertical-rl;
  text-orientation: mixed;
  transform: rotate(180deg);
}

.marginalia-left {
  left: 25px;
  top: 20%;
}

.marginalia-right {
  right: 15px;
  bottom: 30%;
  writing-mode: vertical-lr;
  transform: none;
}

/* ===== RULED LINES (LEDGER) ===== */

.ruled-paper {
  background-image: repeating-linear-gradient(
    180deg,
    transparent 0px,
    transparent 28px,
    rgba(58, 48, 40, 0.15) 28px,
    rgba(58, 48, 40, 0.15) 29px
  );
  background-position: 0 10px;
}

/* ===== THE BEAM ===== */

.lighthouse-beam {
  position: absolute;
  pointer-events: none;
  z-index: 50;
  /* Beam originates from lighthouse position */
  --beam-origin-x: 85%;
  --beam-origin-y: 30%;
  --beam-angle: 0deg;
  --beam-width: 45deg;

  background: conic-gradient(
    from calc(var(--beam-angle) - var(--beam-width) / 2) at var(--beam-origin-x) var(--beam-origin-y),
    transparent 0deg,
    var(--hot-white) 0deg,
    var(--flame-core) 5deg,
    var(--lamp-amber) 15deg,
    var(--burnt-umber) 30deg,
    var(--void) calc(var(--beam-width)),
    transparent calc(var(--beam-width))
  );

  inset: 0;
  opacity: 0.9;
  mix-blend-mode: screen;
}

/* Beam rotation animation */
.lighthouse-beam.rotating {
  animation: beam-rotate 12s linear infinite;
}

@keyframes beam-rotate {
  from { --beam-angle: 0deg; }
  to { --beam-angle: 360deg; }
}

/* Dust motes in the beam */
.beam-dust {
  position: absolute;
  inset: 0;
  pointer-events: none;
  background-image: radial-gradient(
    circle at 50% 50%,
    var(--hot-white) 0%,
    transparent 2%
  );
  background-size: 100px 100px;
  opacity: 0.1;
  animation: dust-drift 8s linear infinite;
}

@keyframes dust-drift {
  from { transform: translate(0, 0); }
  to { transform: translate(20px, 30px); }
}

/* ===== MEMORY BLEED EFFECTS ===== */

.memory-bleed {
  animation: memory-flash 0.5s ease-out;
}

@keyframes memory-flash {
  0% {
    filter: sepia(0) blur(0);
    opacity: 1;
  }
  30% {
    filter: sepia(100%) blur(2px);
    opacity: 0.7;
  }
  60% {
    filter: sepia(80%) blur(1px);
    opacity: 0.85;
  }
  100% {
    filter: sepia(0) blur(0);
    opacity: 1;
  }
}

/* Double exposure for time bleeds */
.time-bleed {
  position: relative;
}

.time-bleed::before {
  content: '';
  position: absolute;
  inset: 0;
  background: inherit;
  opacity: 0.3;
  filter: sepia(100%) blur(1px);
  transform: translate(2px, 1px);
  animation: time-drift 2s ease-in-out infinite;
}

@keyframes time-drift {
  0%, 100% { transform: translate(2px, 1px); opacity: 0.2; }
  50% { transform: translate(3px, 2px); opacity: 0.35; }
}

/* ===== VOID AREAS ===== */

.void-area {
  background: var(--void);
  /* No gradients, no softness - pure black */
}

/* Edge of known world */
.void-edge {
  position: relative;
}

.void-edge::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    to var(--void-direction, bottom),
    transparent 70%,
    var(--void) 100%
  );
  pointer-events: none;
}
